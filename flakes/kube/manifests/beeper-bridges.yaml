---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  finalizers:
  - onepassword.com/finalizer.secret
  generation: 1
  name: beeper-key
  namespace: messaging
spec:
  itemPath: vaults/Kubernetes/items/ujxgo6q3j7k44nr4vgxgkh3zoi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: beeper-bridges
  namespace: messaging
  labels:
    app.kubernetes.io/name: beeper-bridges
    app.kubernetes.io/instance: beeper-bridges
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: beeper-bridges
      app.kubernetes.io/instance: beeper-bridges
  template:
    metadata:
      labels:
        app.kubernetes.io/name: beeper-bridges
        app.kubernetes.io/instance: beeper-bridges
    spec:
      securityContext:
        {}
      containers:
        - name: beeper-signal
          securityContext:
            {}
          image: "ghcr.io/beeper/bridge-manager:8ff78f238554b359e24eb196649eaea0179a700b"
          command:
            - "/bin/ash"
            - "-c"
          volumeMounts:
            - name: signal-config
              mountPath: /data
          args:
            - /usr/local/bin/run-bridge.sh sh-signal-000
          imagePullPolicy: IfNotPresent
          resources:
            {}
          env:
            - name: MATRIX_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  name: beeper-key
                  key: password
        - name: beeper-discord
          securityContext:
            {}
          image: "ghcr.io/beeper/bridge-manager:8ff78f238554b359e24eb196649eaea0179a700b"
          command:
            - "/bin/ash"
            - "-c"
          volumeMounts:
            - name: discord-config
              mountPath: /data
          args:
            - /usr/local/bin/run-bridge.sh sh-discord-000
          imagePullPolicy: IfNotPresent
          resources:
            {}
          env:
            - name: MATRIX_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  name: beeper-key
                  key: password
        # Set up by sending a DM to: `@sh-googlemessages-000bot:beeper.local`
        - name: beeper-google-messages
          securityContext:
            {}
          image: "ghcr.io/beeper/bridge-manager:8ff78f238554b359e24eb196649eaea0179a700b"
          command:
            - "/bin/ash"
            - "-c"
          volumeMounts:
            - name: google-messages-config
              mountPath: /data
          args:
            - /usr/local/bin/run-bridge.sh sh-googlemessages-000
          imagePullPolicy: IfNotPresent
          resources:
            {}
          env:
            - name: MATRIX_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  name: beeper-key
                  key: password
        # Set up by sending a DM to: `@sh-googlevoice-000bot:beeper.local`
        - name: beeper-google-voice
          securityContext:
            {}
          image: "ghcr.io/beeper/bridge-manager:8ff78f238554b359e24eb196649eaea0179a700b"
          command:
            - "/bin/ash"
            - "-c"
          volumeMounts:
            - name: google-voice-config
              mountPath: /data
          args:
            - /usr/local/bin/run-bridge.sh sh-googlevoice-000
          imagePullPolicy: IfNotPresent
          resources:
            {}
          env:
            - name: MATRIX_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  name: beeper-key
                  key: password
        #- name: beeper-irc
        #  securityContext:
        #    {}
        #  image: "ghcr.io/beeper/bridge-manager:8ff78f238554b359e24eb196649eaea0179a700b"
        #  command:
        #    - "/bin/ash"
        #    - "-c"
        #  volumeMounts:
        #    - name: irc-config
        #      mountPath: /data
        #  args:
        #    - /usr/local/bin/run-bridge.sh sh-irc-000
        #  imagePullPolicy: IfNotPresent
        #  resources:
        #    {}
        #  env:
        #    - name: MATRIX_ACCESS_TOKEN
        #      valueFrom:
        #        secretKeyRef:
        #          name: beeper-key
        #          key: password
      volumes:
      - name: signal-config
        hostPath:
          path: /media/data-ssd/beeper/signal
          type: DirectoryOrCreate
      - name: discord-config
        hostPath:
          path: /media/data-ssd/beeper/discord
          type: DirectoryOrCreate
      - name: irc-config
        hostPath:
          path: /media/data-ssd/beeper/irc
          type: DirectoryOrCreate
      - name: google-messages-config
        hostPath:
          path: /media/data-ssd/beeper/googlemessages
          type: DirectoryOrCreate
      - name: google-voice-config
        hostPath:
          path: /media/data-ssd/beeper/googlevoice
          type: DirectoryOrCreate
